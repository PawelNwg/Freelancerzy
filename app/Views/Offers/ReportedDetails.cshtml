@model freelancerzy.Models.Offer

@{
    ViewData["Title"] = "Szczegóły: " + Model.Title;
}
<head>
    <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
          rel="stylesheet">
</head>



<div id="content" class="row bg-white border border-primary rounded pb-3">
    <div class="col-12 mt-4 mb-3">
        <h1>@Model.Title</h1>
    </div>
    <div class="col-lg-9 pr-4">
        Dodał:
        <h4>@Model.User.FirstName - @Model.User.EmailAddress</h4>
        <article>
            <div class="mt-3 text-justify">
                <h2>Szerszy opis usługi</h2>
                <div class="mt-3 mb-3">@Model.Description</div>
            </div>
        </article>
    </div>
    <div class="col-lg-3 mb-5">
        <div style="background-color:lightgray" class="p-3  border border-dark rounded">
            <h5>Szczegóły:</h5>
            @if (Model.Wage == null)
            {
                <div>Stawka: <b>nieokreślona</b></div>
            }
            else
            {
                <div>Stawka: <b>@Model.Wage zł</b></div>
            }
            <div>Kategoria: <b>@Model.Category.CategoryName</b></div>
            <br />
            <h5>Dana kontaktowe:</h5>
            <div>Imię: <b>@Model.User.FirstName</b></div>
            <div>Email: <b>@Model.User.EmailAddress</b></div>
            <div>Numer telefonu: <b>@Model.User.Phonenumber</b></div>

        </div>
    </div>
    <div class="reportDecision">
        <h3 style="color:red;">Zdecyduj, co zrobić z tą ofertą</h3>
        <div class="reportDecisionButtons">
            <button id="cancelBtn" class="btn btn-outline-primary btn-dark">Pozostaw</button>
            <button id="deleteBtn" class="btn btn-outline-primary btn-dark">Usuń</button>
        </div>
        <div id="dialog-1" title="Czy na pewno chcesz usunąć ofertę?">

        </div>
        <div id="dialog-2"
             title="Czy na pewno chcesz pozostawić ofertę?"></div>
    </div>
    <div id="buttons" class="col-12">
        Dodano: <b>@Model.CreationDate</b>, Liczba wyświetleń: @Model.ViewCounter
        <br /><br />
    </div>
    <h2 class="m-2">Zgłoszenia: </h2>
    @foreach(var report in Model.OfferReports)
    {
        <div class="col-12 border rounded border-dark mb-2">
            <dl class="row">
                <dt class="col-2">
                    Powód:
                </dt>
                <dd class="col-10">
                    @report.OfferReportReason.Description
                </dd>
                <dt class="col-2">
                    Data:
                </dt>
                <dd class="col-10">
                    @report.ReportDate
                </dd>
            </dl>
        </div>
    }
    <a class="btn btn-outline-primary btn-dark m-2" href='javascript:history.go(-1)'>Powrót</a>
</div>


<style>
    #content {
        margin: 10%;
        margin-top: 5%;
    }

    .reportDecision {
        margin-left: auto;
        margin-right: auto;
        display: flex;
        flex-direction: column;
    }

    .reportDecisionButtons {
        margin: auto;
    }
</style>
<script>

    const id = @Model.Offerid;

    const DeleteOffer = (id) => {
        $.ajax({
            method: "DELETE",
            url: "/Offers/DeleteReported?id=" + id,
            cache: false

        }
        ).fail(() => alert("Błąd podczas usuwania oferty"))
            .done(() => {
                const url = '@Url.Action("OfferDeleted","Offers",new { id= Model.UserId})';
                window.location.href = url;
            })
    }

    const RejectReport = (id) => {
         $.ajax({
            method: "GET",
            url: "/Offers/RejectReport?id=" + id,
            cache: false

        }
        ).fail(() => alert("Błąd podczas przetwarzania rządania"))
            .done(() => {
                const url = '@Url.Action("ReportedOffers","Offers")';
                window.location.href = url;
            })
    }

    $(function () {
        $('#dialog-1').dialog({
            autoOpen: false,
            modal: true,
            dialogClass: 'border border-dark rounded',
            width: 500,
            show: 'fold',
            hide: 'fold',
            resizable: false,
            closeText: 'Zamknij',
            draggable:false,
            buttons: {
                TAK: function () {
                    DeleteOffer(id);
                },
                NIE: function () {
                    $(this).dialog('close');
                }
            }

        });

        $('#dialog-2').dialog({
            autoOpen: false,
            modal: true,
            dialogClass: 'border border-dark rounded',
            width: 550,
            show: 'fold',
            hide: 'fold',
            resizable: false,
            closeText: 'Zamknij',
            draggable: false,
            buttons: {
                TAK: function () {
                    RejectReport(id);
                },
                NIE: function () {
                    $(this).dialog('close');
                }
            }

        });
        $('#deleteBtn').click(function () {
            $('#dialog-1').dialog("open");
        });


        $('#cancelBtn').click(function () {
            $('#dialog-2').dialog("open");
        });
    });
</script>
@section scripts{
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
}
<style>
    .ui-widget-header, .ui-state-default, ui-button {
        background-color:dimgrey;
        color: black;
        font-weight: bold;
    }
    .ui-dialog {
        padding: 10px;
        background: lightgray;
    }
    
</style>